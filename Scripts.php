<?php   /**
 * Route:
 * https://exampel.com/wp-admin/admin-post.php?action=update_products
 */

add_action('admin_post_update_products', 'run_update_products_with_report');

function run_update_products_with_report() {

    if (!current_user_can('manage_options')) {
        wp_die('Access denied');
    }

    $start_time = microtime(true);

    // ๐น ูุญุตููุงุช
    $product_ids = [7037, 7101];

    // ๐ ููพ ุชุตูุฑ โ ูุชู
    $size_text_map = [

        'girl-drees-size-30.webp' => '
		&nbsp;
<strong>ุฑุงูููุง ุณุงุฒุจูุฏ ูุจุงุณ ุฏุฎุชุฑุงูู (ุณุงุฒ ณฐ)</strong><br>
ุณู: ถ ุชุง ฑฒ ูุงู<br>
ูุฏ ุจููุฒ: ณณ ุณุงูุชโูุชุฑ<br>
ูุฏ ุดููุงุฑ: ดฒ ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ฒท ุณุงูุชโูุชุฑ<br>
ุฏูุฑ ุณูู: ฒต ุณุงูุชโูุชุฑ<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
        ',

        'kuromi-size-30.webp' => '
		&nbsp;
<strong>ุฑุงูููุง ุณุงุฒุจูุฏ ูุจุงุณ ุฏุฎุชุฑุงูู (ุณุงุฒ ณฐ)</strong><br>
ุณู: ถ ุชุง ฑฒ ูุงู<br>
ูุฏ ุจููุฒ: ณฐ ุณุงูุชโูุชุฑ<br>
ูุฏ ุดููุงุฑ: ณธ ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ณฐ ุณุงูุชโูุชุฑ<br>
ุฏูุฑ ุณูู: ฒถ ุณุงูุชโูุชุฑ<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
        ',

        'kuromi-size-35.webp' => '
		&nbsp;
<strong>ุฑุงูููุง ุณุงุฒุจูุฏ ูุจุงุณ ุฏุฎุชุฑุงูู (ุณุงุฒ ณต)</strong><br>
ุณู: ฑฒ ุชุง ฒด ูุงู<br>
ูุฏ ุจููุฒ: ณต ุณุงูุชโูุชุฑ<br>
ูุฏ ุดููุงุฑ: ดณ ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ณฑ ุณุงูุชโูุชุฑ<br>
ุฏูุฑ ุณูู: ฒธ ุณุงูุชโูุชุฑ<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
        ',
		     '24-months.webp' => '
			 	&nbsp;
			 <strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุจุงุฏ ู ุดููุงุฑ (ุณุงุฒ ฒด)</strong><br>
ุณู: ฑธ ุชุง ฒด ูุงู<br>
ูุฏ ุจุงุฏ: ดถ ุณุงูุชโูุชุฑ<br>
ูุฏ ุดููุงุฑ: ดต ุณุงูุชโูุชุฑ<br>
ูุฏ ุดููุงุฑ ุชุง ูุงู: ฒฐ ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู ุจููุฏ: ณฒ ุณุงูุชโูุชุฑ<br>
ุฏูุฑ ุณูู: ฒด ุณุงูุชโูุชุฑ<br>
ูุฒู ฺฉูุฏฺฉ: ฑฒ ุชุง ฑด ฺฉููฺฏุฑู<br>
ูุฏ ฺฉูุฏฺฉ: นฐ ุชุง นธ ุณุงูุชโูุชุฑ<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
'
		,
        	     '3-months.webp' => '
			 	&nbsp;<strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุจุงุฏ ู ุดููุงุฑ (ุณุงุฒ ณ)</strong><br>
ููุงุณุจ ุจุฑุง: ฐ ุชุง ณ ูุงู<br>
ูุฏ ุจุงุฏ: ณท ุณุงูุชโูุชุฑ | ูุฏ ุดููุงุฑ: ณฐ ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ฑธ ุณุงูุชโูุชุฑ | ุฏูุฑ ุณูู: ฑน ุณุงูุชโูุชุฑ<br>
ูุฏ ฺฉูุฏฺฉ: ตฐ ุชุง ตธ ุณุงูุชโูุชุฑ | ูุฒู: ณ ุชุง ด ฺฉููฺฏุฑู<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
' ,
	     '9-months.webp' => '
			 	&nbsp;<strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุจุงุฏ ู ุดููุงุฑ (ุณุงุฒ น)</strong><br>
ููุงุณุจ ุจุฑุง: ถ ุชุง น ูุงู<br>
ูุฏ ุจุงุฏ: ดฐ ุณุงูุชโูุชุฑ | ูุฏ ุดููุงุฑ: ณต ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ฒฒ ุณุงูุชโูุชุฑ | ุฏูุฑ ุณูู: ฒฐ ุณุงูุชโูุชุฑ<br>
ูุฏ ฺฉูุฏฺฉ: ถถ ุชุง ทด ุณุงูุชโูุชุฑ | ูุฒู: ถ ุชุง ธ ฺฉููฺฏุฑู<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
' , 
'12-months.webp' => '
			 	&nbsp;
                <strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุจุงุฏ ู ุดููุงุฑ (ุณุงุฒ ฑฒ)</strong><br>
ููุงุณุจ ุจุฑุง: น ุชุง ฑฒ ูุงู<br>
ูุฏ ุจุงุฏ: ดฒ ุณุงูุชโูุชุฑ | ูุฏ ุดููุงุฑ: ณธ ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ฒด ุณุงูุชโูุชุฑ | ุฏูุฑ ุณูู: ฒฑ ุณุงูุชโูุชุฑ<br>
ูุฏ ฺฉูุฏฺฉ: ทด ุชุง ธฒ ุณุงูุชโูุชุฑ | ูุฒู: ธ ุชุง ฑฐ ฺฉููฺฏุฑู<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
' , 

'18-months.webp' => '
			 	&nbsp;<strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุจุงุฏ ู ุดููุงุฑ (ุณุงุฒ ฑธ)</strong><br>
ููุงุณุจ ุจุฑุง: ฑฒ ุชุง ฑธ ูุงู<br>
ูุฏ ุจุงุฏ: ดด ุณุงูุชโูุชุฑ | ูุฏ ุดููุงุฑ: ดฒ ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ฒธ ุณุงูุชโูุชุฑ | ุฏูุฑ ุณูู: ฒฒ ุณุงูุชโูุชุฑ<br>
ูุฏ ฺฉูุฏฺฉ: ธฒ ุชุง นฐ ุณุงูุชโูุชุฑ | ูุฒู: ฑฐ ุชุง ฑฒ ฺฉููฺฏุฑู<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
' , 
   '24-months.webp' => '
			 	&nbsp;
			 <strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุจุงุฏ ู ุดููุงุฑ (ุณุงุฒ ฒด)</strong><br>
ุณู: ฑธ ุชุง ฒด ูุงู<br>
ูุฏ ุจุงุฏ: ดถ ุณุงูุชโูุชุฑ<br>
ูุฏ ุดููุงุฑ: ดต ุณุงูุชโูุชุฑ<br>
ูุฏ ุดููุงุฑ ุชุง ูุงู: ฒฐ ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู ุจููุฏ: ณฒ ุณุงูุชโูุชุฑ<br>
ุฏูุฑ ุณูู: ฒด ุณุงูุชโูุชุฑ<br>
ูุฒู ฺฉูุฏฺฉ: ฑฒ ุชุง ฑด ฺฉููฺฏุฑู<br>
ูุฏ ฺฉูุฏฺฉ: นฐ ุชุง นธ ุณุงูุชโูุชุฑ<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>'
,

'36-months.webp' => '
			 	&nbsp;
                <strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุจุงุฏ ู ุดููุงุฑ (ุณุงุฒ ณถ)</strong><br>
ููุงุณุจ ุจุฑุง: ฒด ุชุง ณถ ูุงู<br>
ูุฏ ุจุงุฏ: ดธ ุณุงูุชโูุชุฑ | ูุฏ ุดููุงุฑ: ดน ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ณณ ุณุงูุชโูุชุฑ | ุฏูุฑ ุณูู: ฒด ุณุงูุชโูุชุฑ<br>
ูุฏ ฺฉูุฏฺฉ: นธ ุชุง ฑฐถ ุณุงูุชโูุชุฑ | ูุฒู: ฑด ุชุง ฑถ ฺฉููฺฏุฑู<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
' , 

'48-months.webp' => '
			 	&nbsp;
                <strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุจุงุฏ ู ุดููุงุฑ (ุณุงุฒ ดธ)</strong><br>
ููุงุณุจ ุจุฑุง: ณถ ุชุง ดธ ูุงู<br>
ูุฏ ุจุงุฏ: ตด ุณุงูุชโูุชุฑ | ูุฏ ุดููุงุฑ: ตด ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ณด ุณุงูุชโูุชุฑ | ุฏูุฑ ุณูู: ฒถ ุณุงูุชโูุชุฑ<br>
ูุฏ ฺฉูุฏฺฉ: ฑฐถ ุชุง ฑฑด ุณุงูุชโูุชุฑ | ูุฒู: ฑถ ุชุง ฑธ ฺฉููฺฏุฑู<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
' , 

'flower-girl-size-30.webp' => '
			 	&nbsp;
                <strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุฏุฎุชุฑุงูู (ุณุงุฒ ณฐ)</strong><br>
ุณู: ถ ุชุง ฑฒ ูุงู<br>
ูุฏ ุจููุฒ: ณฑ ุณุงูุชโูุชุฑ | ูุฏ ุดููุงุฑ: ณน ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ฒน ุณุงูุชโูุชุฑ | ุฏูุฑ ุณูู: ฒฐ ุณุงูุชโูุชุฑ<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
' , 

'flower-girl-size-35.webp' => '
			 	&nbsp;<strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุฏุฎุชุฑุงูู (ุณุงุฒ ณต)</strong><br>
ุณู: ฑฒ ุชุง ฒด ูุงู<br>
ูุฏ ุจููุฒ: ณด ุณุงูุชโูุชุฑ | ูุฏ ุดููุงุฑ: ดด ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ณฒ ุณุงูุชโูุชุฑ | ุฏูุฑ ุณูู: ฒฒ ุณุงูุชโูุชุฑ<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
' , 
// ... ุงุฏุงูู ููุงุฑุฏ ูุจู ...

        'snoopy-size-25.webp' => '
        &nbsp;
<strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุงุณูููพ (ุณุงุฒ ฒต)</strong><br>
ููุงุณุจ ุจุฑุง: ฐ ุชุง ถ ูุงู<br>
ูุฏ ุจููุฒ: ฒธ ุณุงูุชโูุชุฑ | ูุฏ ุดููุงุฑ: ณถ ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ฒฒ ุณุงูุชโูุชุฑ | ุฏูุฑ ุณูู: ฒด ุณุงูุชโูุชุฑ<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
        ',

        'snoopy-size-30.webp' => '
        &nbsp;
<strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุงุณูููพ (ุณุงุฒ ณฐ)</strong><br>
ููุงุณุจ ุจุฑุง: ถ ุชุง ฑฒ ูุงู<br>
ูุฏ ุจููุฒ: ณณ ุณุงูุชโูุชุฑ | ูุฏ ุดููุงุฑ: ดฒ ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ฒท ุณุงูุชโูุชุฑ | ุฏูุฑ ุณูู: ฒต ุณุงูุชโูุชุฑ<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
        ',

        'snoopy-size-35.webp' => '
        &nbsp;
<strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุงุณูููพ (ุณุงุฒ ณต)</strong><br>
ููุงุณุจ ุจุฑุง: ฑฒ ุชุง ฒด ูุงู<br>
ูุฏ ุจููุฒ: ณถ ุณุงูุชโูุชุฑ | ูุฏ ุดููุงุฑ: ดธ ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ณฐ ุณุงูุชโูุชุฑ | ุฏูุฑ ุณูู: ฒท ุณุงูุชโูุชุฑ<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
        ',

        'teddy-size-35.webp' => '
        &nbsp;
<strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุชุฏ (ุณุงุฒ ณต)</strong><br>
ููุงุณุจ ุจุฑุง: ฑฒ ุชุง ฒด ูุงู<br>
ูุฏ ุจููุฒ: ณต ุณุงูุชโูุชุฑ | ูุฏ ุดููุงุฑ: ดณ ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ณฑ ุณุงูุชโูุชุฑ | ุฏูุฑ ุณูู: ฒธ ุณุงูุชโูุชุฑ<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
        ',

        'size-30.webp' => '
        &nbsp;
<strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุฏุฎุชุฑุงูู (ุณุงุฒ ณฐ)</strong><br>
ููุงุณุจ ุจุฑุง: ถ ุชุง ฑฒ ูุงู<br>
ูุฏ ุจููุฒ: ณฐ ุณุงูุชโูุชุฑ | ูุฏ ุดููุงุฑ: ณธ ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ณฐ ุณุงูุชโูุชุฑ | ุฏูุฑ ุณูู: ฒถ ุณุงูุชโูุชุฑ<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
        ',

        'size-35.webp' => '
        &nbsp;
<strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุฏุฎุชุฑุงูู (ุณุงุฒ ณต)</strong><br>
ููุงุณุจ ุจุฑุง: ฑฒ ุชุง ฒด ูุงู<br>
ูุฏ ุจููุฒ: ณต ุณุงูุชโูุชุฑ | ูุฏ ุดููุงุฑ: ดณ ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ณฑ ุณุงูุชโูุชุฑ | ุฏูุฑ ุณูู: ฒธ ุณุงูุชโูุชุฑ<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
        ',

        'size-40.webp' => '
        &nbsp;
<strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุฏุฎุชุฑุงูู (ุณุงุฒ ดฐ)</strong><br>
ููุงุณุจ ุจุฑุง: ฒ ุชุง ณ ุณุงู<br>
ูุฏ ุจููุฒ: ดฐ ุณุงูุชโูุชุฑ | ูุฏ ุดููุงุฑ: ตด ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ณต ุณุงูุชโูุชุฑ | ุฏูุฑ ุณูู: ณฐ ุณุงูุชโูุชุฑ<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
        ',

        'size-45.webp' => '
        &nbsp;
<strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุฏุฎุชุฑุงูู (ุณุงุฒ ดต)</strong><br>
ููุงุณุจ ุจุฑุง: ด ุชุง ต ุณุงู<br>
ูุฏ ุจููุฒ: ดต ุณุงูุชโูุชุฑ | ูุฏ ุดููุงุฑ: ถฐ ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ณน ุณุงูุชโูุชุฑ | ุฏูุฑ ุณูู: ณฒ ุณุงูุชโูุชุฑ<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
        ',

        'pants-size-48.webp' => '
        &nbsp;
<strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุดููุงุฑ (ุณุงุฒ ดธ)</strong><br>
ููุงุณุจ ุจุฑุง: ณถ ุชุง ดธ ูุงู<br>
ูุฏ ุดููุงุฑ: ดน ุณุงูุชโูุชุฑ<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
        ',

        'pants-size-56.webp' => '
        &nbsp;
<strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุดููุงุฑ (ุณุงุฒ ตถ)</strong><br>
ููุงุณุจ ุจุฑุง: ด ุชุง ต ุณุงู<br>
ูุฏ ุดููุงุฑ: ตท ุณุงูุชโูุชุฑ<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
        ',

    'teddy-size-40.webp' => '
        &nbsp;
<strong>ุฑุงูููุง ุณุงุฒุจูุฏ ุณุช ุชุฏ (ุณุงุฒ ดฐ)</strong><br>
ููุงุณุจ ุจุฑุง: ฒ ุชุง ณ ุณุงู<br>
ูุฏ ุจููุฒ: ดฐ ุณุงูุชโูุชุฑ | ูุฏ ุดููุงุฑ: ตด ุณุงูุชโูุชุฑ<br>
ุงูุฏุงุฒู ุขุณุชู: ณต ุณุงูุชโูุชุฑ | ุฏูุฑ ุณูู: ณฐ ุณุงูุชโูุชุฑ<br>
<small>ุงูฺฉุงู ุฎุทุง ฑ ุชุง ฒ ุณุงูุชโูุชุฑ ูุฌูุฏ ุฏุงุฑุฏ.</small>
        ',
    ];

    $stats = [
        'total'   => count($product_ids),
        'updated' => 0,
        'skipped' => 0,
        'errors'  => 0,
    ];

    $timeline = [];

    foreach ($product_ids as $product_id) {

        $timeline[] = "๐ ุจุฑุฑุณ ูุญุตูู {$product_id}";

        $excerpt = get_post_field('post_excerpt', $product_id);

        if (!$excerpt) {
            $timeline[] = "โ ุชูุถุญุงุช ฺฉูุชุงู ุฎุงู ุงุณุช";
            $stats['errors']++;
            continue;
        }

        // ุญุฐู ุจูุงฺฉโูุง ูุจู
        $excerpt = preg_replace(
            '/<div class="size-guide">.*?<\/div>/si',
            '',
            $excerpt
        );

        // ฺฏุฑูุชู ููู ุชุตุงูุฑ
        preg_match_all('/<img[^>]+src="([^">]+)"/i', $excerpt, $matches);

        if (empty($matches[1])) {
            $timeline[] = "โ ุชุตูุฑ ูพุฏุง ูุดุฏ";
            $stats['errors']++;
            continue;
        }

        $size_blocks = '';
        $found_any = false;

        foreach ($matches[1] as $img_src) {

            $img_name = basename($img_src);
            $timeline[] = "๐ผ ุชุตูุฑ: {$img_name}";

            if (!isset($size_text_map[$img_name])) {
                $timeline[] = "โ๏ธ ูุชู ุจุฑุง ุงู ุชุตูุฑ ุชุนุฑู ูุดุฏู";
                continue;
            }

            $size_blocks .= '<div class="size-guide">' . $size_text_map[$img_name] . '</div>';
            $found_any = true;
        }

        if (!$found_any) {
            $stats['skipped']++;
            continue;
        }

        $new_excerpt = trim($excerpt) . $size_blocks;

        wp_update_post([
            'ID'           => $product_id,
            'post_excerpt' => $new_excerpt,
        ]);

        $timeline[] = "โ ุขูพุฏุช ุดุฏ (ฺูุฏ ุชุตูุฑ)";
        $stats['updated']++;
    }

    $duration = round(microtime(true) - $start_time, 2);
    ?>
<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>ฺฏุฒุงุฑุด ุจุฑูุฒุฑุณุงู</title>

<style>
@import url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/fonts/webfonts/Vazirmatn-font-face.css');

* {
    font-family: Vazirmatn, Tahoma, sans-serif;
}

body {
    background:#f4f6f8;
    direction:rtl;
    padding:40px;
}

.box {
    max-width:900px;
    margin:auto;
    background:#fff;
    border-radius:14px;
    box-shadow:0 10px 30px rgba(0,0,0,.08);
    padding:30px;
}

.stats {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    gap:15px;
    margin:25px 0;
}

.stat {
    padding:15px;
    border-radius:10px;
    text-align:center;
    background:#f9fafb;
}

.timeline {
    background:#0f172a;
    color:#e5e7eb;
    padding:20px;
    border-radius:12px;
    font-family: Consolas, monospace;
    font-size:13px;
    white-space:pre-line;
    line-height:1.9;
}

/* โ ูุงุตูู ุจู ุฎุทูุท ูุชู ุณุงุฒุจูุฏ */
.size-guide {
    margin-top:15px;
    padding:12px;
    background:#f8fafc;
    border-radius:10px;
    line-height:1.9;
}

.size-guide br {
    display:block;
    margin-bottom:6px;
}

.size-guide strong {
    display:block;
    margin-bottom:8px;
}

.size-guide small {
    display:block;
    margin-top:8px;
    color:#64748b;
}
</style>
</head>

<body>
<div class="box">

<h2>๐ฆ ฺฏุฒุงุฑุด ุงุฌุฑุง ุจุฑูุฒุฑุณุงู ูุญุตููุงุช</h2>

โฑ ูุฏุช ุงุฌุฑุง: <strong><?php echo esc_html($duration); ?> ุซุงูู</strong><br>
๐ ุชุงุฑุฎ ุงุฌุฑุง: <?php echo esc_html(date('Y-m-d H:i:s')); ?>

<div class="stats">
    <div class="stat">ฺฉู: <?php echo $stats['total']; ?></div>
    <div class="stat">โ ูููู: <?php echo $stats['updated']; ?></div>
    <div class="stat">โ๏ธ ุงุณฺฉูพ: <?php echo $stats['skipped']; ?></div>
    <div class="stat">โ ุฎุทุง: <?php echo $stats['errors']; ?></div>
</div>

<div class="timeline"><?php echo esc_html(implode("\n", $timeline)); ?></div>

</div>
</body>
</html>
<?php
exit;
}
